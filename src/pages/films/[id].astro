---
import Layout from "../../layouts/Layout.astro";
import ImgPb from "../../components/ImgPb.astro";
import { getFilmById, getAllFilmsSorted } from "../../../backend/backend.mjs";!


// üöÄ Ajout de `getStaticPaths()`
export async function getStaticPaths() {
    const films = await getAllFilmsSorted();
    console.log("Films r√©cup√©r√©s pour les routes dynamiques :", films);

    return films.map((film) => ({
        params: { id: film.id.toString() }, // Convertir en string si n√©cessaire
    }));
}

// V√©rification de l'ID r√©cup√©r√©
const { params } = Astro.props;
console.log("ID r√©cup√©r√© :", params.id);

if (!params || !params.id) {
    throw new Error("Aucun ID fourni pour r√©cup√©rer le film.");
}

const film = await getFilmById(params.id);
console.log("Film r√©cup√©r√© :", film);

if (!film) {
    throw new Error(`Aucun film trouv√© avec l'ID ${params.id}`);
}
---
<Layout title={film ? film.titre : "Chargement..."}>
    {film ? (
        <section class="pt-32 pb-16 bg-black text-white text-center">
            <h1 class="text-5xl font-bold mb-6">{film.titre}</h1>
            <div class="max-w-4xl mx-auto">
                <!-- Affiche du film -->
                <ImgPb
                    record={film}
                    field="affiche"
                    alt={film.titre}
                    classPicture="w-full max-w-lg mx-auto rounded-lg shadow-lg"
                />

                <!-- Synopsis -->
                <p class="text-lg mt-6">{film.synopsis}</p>

                <!-- Bande-annonce -->
                {film.bande_annonce && (
                    <div class="mt-6">
                        <iframe
                            class="w-full max-w-lg mx-auto rounded-lg"
                            width="560"
                            height="315"
                            src={film.bande_annonce}
                            title="Bande-annonce"
                            frameborder="0"
                            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                        />
                    </div>
                )}

                <!-- Infos techniques -->
                <div class="mt-8 text-lg bg-gray-900 p-6 rounded-lg">
                    <p><strong>Dur√©e :</strong> {film.duree} minutes</p>
                    <p><strong>Langue :</strong> {film.langue}</p>
                    <p><strong>Production :</strong> {film.production}</p>
                </div>

                <!-- Invit√© associ√© -->
                {film.invite && (
                    <div class="mt-8 bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-2xl font-semibold">Invit√© associ√©</h3>
                        <p class="mt-2 text-lg">{film.invite.nom}</p>
                    </div>
                )}
            </div>
        </section>
    ) : (
        <section class="pt-32 pb-16 text-white text-center">
            <p>Chargement du film...</p>
        </section>
    )}
</Layout>
